<!-- admin.html -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Collentmart Admin</title>
  <script type="module" src="firebase.js"></script>
  <script type="module">
    import {
      database, ref, push, set, remove, onValue,
      storage, sRef, uploadBytes, getDownloadURL
    } from './firebase.js';

    const dbRef = ref(database, 'produk');

    const form = document.getElementById("form");
    const produkList = document.getElementById("produkList");

    const renderProduk = () => {
      onValue(dbRef, (snapshot) => {
        produkList.innerHTML = "";
        snapshot.forEach((child) => {
          const data = child.val();
          const key = child.key;

          const item = document.createElement("div");
          item.innerHTML = `
            <div style="border:1px solid #ccc; margin:10px; padding:10px; border-radius:8px;">
              <img src="${data.gambar}" width="100%" style="border-radius:6px;"/>
              <h3>${data.nama}</h3>
              <p>Rp ${data.harga}</p>
              <button onclick="hapusProduk('${key}')">Hapus</button>
            </div>
          `;
          produkList.appendChild(item);
        });
      });
    };

    renderProduk();

    form.onsubmit = async (e) => {
      e.preventDefault();
      const nama = form.nama.value;
      const harga = form.harga.value;
      const file = form.gambar.files[0];

      if (!nama || !harga || !file) {
        alert("Lengkapi semua data!");
        return;
      }

      const storageRef = sRef(storage, 'produk/' + file.name);
      await uploadBytes(storageRef, file);
      const url = await getDownloadURL(storageRef);

      const newRef = push(dbRef);
      set(newRef, {
        nama,
        harga,
        gambar: url
      });

      form.reset();
    };

    window.hapusProduk = (key) => {
      remove(ref(database, 'produk/' + key));
    };
  </script>
</head>
<body>
  <h2>Panel Admin Collentmart</h2>
  <form id="form">
    <input type="text" name="nama" placeholder="Nama Produk" required /><br/>
    <input type="number" name="harga" placeholder="Harga Produk" required /><br/>
    <input type="file" name="gambar" accept="image/*" required /><br/>
    <button type="submit">Upload Produk</button>
  </form>

  <hr/>

  <h3>Daftar Produk</h3>
  <div id="produkList"></div>
</body>
</html>
