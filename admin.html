<!-- admin.html (fix WebView APK) -->
<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Collentmart Admin</title>

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-storage-compat.js"></script>

  <script>
    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCL-26dKIBz3-npBhWnkFV_uQVjNBMonIw",
      authDomain: "collentmart.firebaseapp.com",
      projectId: "collentmart",
      storageBucket: "collentmart.appspot.com",
      messagingSenderId: "393900515991",
      appId: "1:393900515991:web:972f3a34463d6354d3bfd2",
      measurementId: "G-TSJLHNB5NR"
    };

    // Init
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();
    const storage = firebase.storage();

    function uploadProduk(e) {
      e.preventDefault();
      const nama = document.getElementById("nama").value;
      const harga = document.getElementById("harga").value;
      const gambar = document.getElementById("gambar").files[0];

      if (!nama || !harga || !gambar) {
        alert("Semua field wajib diisi!");
        return;
      }

      const storageRef = storage.ref('produk/' + gambar.name);
      storageRef.put(gambar).then(snapshot => {
        snapshot.ref.getDownloadURL().then(url => {
          const produkRef = database.ref('produk').push();
          produkRef.set({
            nama: nama,
            harga: harga,
            gambar: url
          });
          document.getElementById("form").reset();
          alert("Produk berhasil diupload!");
        });
      }).catch(error => {
        alert("Gagal upload gambar: " + error.message);
      });
    }

    function tampilkanProduk() {
      const produkList = document.getElementById("produkList");
      firebase.database().ref('produk').on('value', snapshot => {
        produkList.innerHTML = "";
        snapshot.forEach(child => {
          const data = child.val();
          const key = child.key;

          const div = document.createElement("div");
          div.innerHTML = `
            <div style="border:1px solid #ccc; padding:10px; margin:10px; border-radius:8px;">
              <img src="${data.gambar}" width="100%" style="border-radius:6px;"/>
              <h3>${data.nama}</h3>
              <p>Rp ${data.harga}</p>
              <button onclick="hapusProduk('${key}')">Hapus</button>
            </div>
          `;
          produkList.appendChild(div);
        });
      });
    }

    function hapusProduk(key) {
      firebase.database().ref('produk/' + key).remove();
    }

    window.onload = tampilkanProduk;
  </script>

</head>
<body>
  <h2>Panel Admin Collentmart</h2>
  <form id="form" onsubmit="uploadProduk(event)">
    <input type="text" id="nama" placeholder="Nama Produk" required /><br/>
    <input type="number" id="harga" placeholder="Harga Produk" required /><br/>
    <input type="file" id="gambar" accept="image/*" required /><br/>
    <button type="submit">Upload Produk</button>
  </form>

  <hr/>

  <h3>Daftar Produk</h3>
  <div id="produkList"></div>
</body>
</html>
